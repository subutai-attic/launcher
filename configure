#!/bin/bash

helpmessage()
{
cat <<ENDOFMSG
usage: configure [options]
Configuration script for Subutai Launcher on Linux and MacOS platforms. 

Options:
    --help
      Displays this help message.

    --python=<version>
      Specify a version of python to use. Possible values are:
      python2.7, python3.5 and python3.5

    --no-tests
      Disable building of tests

    --no-ui
      Disable building of UI client

    --no-cli
      Disable build of CLI client

    --static 
      Build only static library (disables dynamic)

    --dynamic 
      Build only dynamic library (disabled static)

ENDOFMSG
exit
}

tests=1
static=""
dynamic=""
python="python2.7"
pylib=""

check_python()
{
    if [ "$1" != "python2.7" -a "$1" != "python3.4" -a "$1" != "python3.5" ]; then
        echo "Bad value for --python"
        echo ""
        helpmessage
    fi
    echo "Looking for python library path..."
    pypath=`find /usr/lib/$1 -name "lib$1.so"`
    if [ $? == 0 ]; then
        echo $pylib
        pylib=`dirname $pypath`
    else
        echo "Failed to find path to python library"
    fi
}

while [ $# -ge 1 ]; do

    case "$1" in
        --python=*)
            python="`echo ${1} | awk '{print substr($0,10)}' | tr ',;' '  '`" 
            check_python $python
            ;;

        --help)
            helpmessage ;;
        *)
            echo "Unrecongnized arguments"
            echo ""
            helpmessage ;;
    esac

    shift
done

echo "# generated by configure script" > config.make
echo "PYTHON_VER = $python" >> config.make
echo "PYLIB_DIR = $pylib" >> config.make
cat <<__EOF__ >>config.make
export PYTHON_VER
export PYLIB_DIR
__EOF__
